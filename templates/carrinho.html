<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Seu Carrinho - Noir Store</title>
</head>

<body>

    <!-- Navegação / Cabeçalho -->
    <header>
        <a href="/" class="logo">Noir Store</a>
        <div class="user-menu">
            {% if logado %}
            <span>Olá, {{ usuario }}!</span>
            <a href="/logout">Sair</a>
            {% else %}
            <a href="/login">Login</a>
            <a href="/cadastro">Cadastro</a>
            {% endif %}
            <a href="/carrinho">Carrinho</a>
        </div>
    </header>

    <main>
        <h1>Seu Carrinho</h1>

        <a href="/">&larr; Voltar para Home</a>

        {% if itens %}
        <div class="lista-itens">
            {% for item in itens %}
            <div class="item-carrinho" id="item-{{ item.carrinho_id }}">
                <!-- Detalhes do Produto no Carrinho -->
                <h2>{{ item.nome }}</h2>
                <img src="{{ url_for('static', filename='uploads/' + item.foto) }}" alt="Foto de {{ item.nome }}"
                    onerror="this.onerror=null;this.src='https://placehold.co/100x100?text=Sem+Imagem';" width="100"
                    height="100">

                <p>Preço Unitário: R$ {{ item.preco_display }}</p>
                <p>Tamanho: {{ item.tamanho_selecionado or 'N/A' }}</p>
                <p>Subtotal: R$ {{ item.subtotal_display }}</p>

                <!-- Formulário de Atualização de Quantidade -->
                <form action="/atualizar_carrinho/{{ item.carrinho_id }}" method="POST">
                    <label for="quantidade-{{ item.carrinho_id }}">Quantidade atual:</label>
                    <input type="number" id="quantidade-{{ item.carrinho_id }}" name="quantidade"
                        value="{{ item.quantidade }}" min="1">
                    <button type="submit">Atualizar Quantidade</button>
                </form>

                <!-- Formulário de Remoção -->
                <form action="/remover_do_carrinho/{{ item.carrinho_id }}" method="POST">
                    <button type="submit">Remover do Carrinho</button>
                </form>

                <hr>
            </div>
            {% endfor %}
        </div>

        <!-- Resumo do Carrinho -->
        <div class="resumo-carrinho">
            <h2>Total do Pedido</h2>
            <p>Total (sem frete): R$ {{ total_display }}</p>

            {% if total_desconto_display %}
            <h3>Total com desconto: R$ {{ total_desconto_display }}</h3>
            <p><strong>Cupom aplicado:</strong> {{ cupom_aplicado }}</p>
            {% endif %}

            <!-- Formulário de Cupom -->
            <form action="/aplicar_cupom" method="POST">
                <label for="cupom">Insira o cupom de desconto:</label>
                <input type="text" id="cupom" name="cupom" placeholder="CUPOM">
                <button type="submit">Aplicar Cupom</button>
            </form>

            {% if mensagem_cupom %}
            <p><strong>{{ mensagem_cupom }}</strong></p>
            {% endif %}

            <hr>

            <h3>Calcular Frete</h3>
            <div id="frete">
                <form id="form-frete">
                    <label for="cep">CEP:</label>
                    <input type="text" id="cep" name="cep" maxlength="9" placeholder="00000-000" required>
                    <button type="submit">Calcular Frete</button>
                </form>
                <div id="resultado" style="margin-top: 10px;"></div>
            </div>

            <hr>

            <!-- Botão de Checkout -->
            <button onclick="alert('Funcionalidade de Checkout')">Finalizar Compra</button>
        </div>

        {% else %}
        <p>Seu carrinho está vazio.</p>
        {% endif %}

    </main>

</body>

</html>